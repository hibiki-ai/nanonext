<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NNG (Nanomsg Next Gen) Lightweight Messaging Library • nanonext</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><link href="extra.css" rel="stylesheet">
<meta property="og:title" content="NNG (Nanomsg Next Gen) Lightweight Messaging Library">
<meta property="og:description" content="R binding for NNG (Nanomsg Next Gen), a successor to ZeroMQ. NNG is 
    a socket library providing high-performance scalability protocols,
    implementing a cross-platform standard for messaging and communications.
    Serves as a concurrency framework that can be used for building distributed 
    applications.">
<meta property="og:image" content="https://shikokuchuo.net/nanonext/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">nanonext</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0.9004</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/shikokuchuo/nanonext/" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://shikokuchuo.net/" class="external-link">
    <span class="fa fa-cube"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="nanonext-">nanonext <a href="https://shikokuchuo.net/nanonext/" alt="nanonext"><img src="reference/figures/logo.png" alt="nanonext logo" align="right" width="120"></a>
<a class="anchor" aria-label="anchor" href="#nanonext-"></a>
</h1></div>
<!-- badges: start -->

<p>R binding for NNG (Nanomsg Next Gen), a successor to ZeroMQ. NNG is a socket library providing high-performance scalability protocols, implementing a cross-platform standard for messaging and communications. Serves as a concurrency framework that can be used for building distributed applications.</p>
<p>Designed for performance and reliability, the NNG library is written in C and {nanonext} is a lightweight wrapper depending on no other packages. Provides the interface for code and processes to communicate with each other - receive data generated in Python, perform analysis in R, and send results to a C++ program – all on the same computer or on networks spanning the globe.</p>
<p>Implemented scalability protocols:</p>
<ul>
<li>Bus (routing)</li>
<li>Pair (two-way radio)</li>
<li>Pipeline (one-way pipe)</li>
<li>Publisher/Subscriber (topics &amp; broadcast)</li>
<li>Request/Reply (I ask, you answer)</li>
<li>Survey (everyone votes)</li>
</ul>
<p>Implemented transports:</p>
<ul>
<li>inproc (intra-process)</li>
<li>IPC (inter-process)</li>
<li>TCP/IP (IPv4 or IPv6)</li>
<li>WebSocket</li>
</ul>
<div class="section level3">
<h3 id="table-of-contents">Table of Contents<a class="anchor" aria-label="anchor" href="#table-of-contents"></a>
</h3>
<ol style="list-style-type: decimal">
<li><a href="#installation">Installation</a></li>
<li><a href="#interfaces">Interfaces</a></li>
<li><a href="#cross-language-exchange">Cross-language Exchange</a></li>
<li><a href="#async-and-concurrency">Async and Concurrency</a></li>
<li><a href="#rpc-and-distributed-computing">RPC and Distributed Computing</a></li>
<li><a href="#publisher-subscriber-model">Publisher / Subscriber Model</a></li>
<li><a href="#ncurl-minimalist-http-client">ncurl Minimalist http Client</a></li>
<li><a href="#building-from-source">Building from source</a></li>
<li><a href="#links">Links</a></li>
</ol>
</div>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p>Install the latest release from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"nanonext"</span><span class="op">)</span></code></pre></div>
<p>or the development version from rOpenSci R-universe:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"nanonext"</span>, repos <span class="op">=</span> <span class="st">"https://shikokuchuo.r-universe.dev"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="interfaces">Interfaces<a class="anchor" aria-label="anchor" href="#interfaces"></a>
</h3>
<p>{nanonext} offers 2 equivalent interfaces: an object-oriented interface, and a functional interface.</p>
<div class="section level4">
<h4 id="object-oriented-interface">Object-oriented Interface<a class="anchor" aria-label="anchor" href="#object-oriented-interface"></a>
</h4>
<p>The primary object in the object-oriented interface is the nano object. Use <code><a href="reference/nano.html">nano()</a></code> to create a nano object which encapsulates a Socket and Dialer/Listener. Methods such as <code>$send()</code> or <code>$recv()</code> can then be accessed directly from the object.</p>
<p><em>Example using Request/Reply (REQ/REP) protocol with inproc transport:</em> <br> (The inproc transport uses zero-copy where possible for a much faster solution than alternatives)</p>
<p>Create nano objects:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shikokuchuo.net/nanonext/">nanonext</a></span><span class="op">)</span>
<span class="va">nano1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/nano.html">nano</a></span><span class="op">(</span><span class="st">"req"</span>, listen <span class="op">=</span> <span class="st">"inproc://nanonext"</span><span class="op">)</span>
<span class="va">nano2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/nano.html">nano</a></span><span class="op">(</span><span class="st">"rep"</span>, dial <span class="op">=</span> <span class="st">"inproc://nanonext"</span><span class="op">)</span></code></pre></div>
<p>Send message from ‘nano1’:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nano1</span><span class="op">$</span><span class="fu">send</span><span class="op">(</span><span class="st">"hello world!"</span><span class="op">)</span>
<span class="co">#&gt;  [1] 58 0a 00 00 00 03 00 04 01 02 00 03 05 00 00 00 00 05 55 54 46 2d 38 00 00</span>
<span class="co">#&gt; [26] 00 10 00 00 00 01 00 04 00 09 00 00 00 0c 68 65 6c 6c 6f 20 77 6f 72 6c 64</span>
<span class="co">#&gt; [51] 21</span></code></pre></div>
<p>Receive message using ‘nano2’:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nano2</span><span class="op">$</span><span class="fu">recv</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; $raw</span>
<span class="co">#&gt;  [1] 58 0a 00 00 00 03 00 04 01 02 00 03 05 00 00 00 00 05 55 54 46 2d 38 00 00</span>
<span class="co">#&gt; [26] 00 10 00 00 00 01 00 04 00 09 00 00 00 0c 68 65 6c 6c 6f 20 77 6f 72 6c 64</span>
<span class="co">#&gt; [51] 21</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $data</span>
<span class="co">#&gt; [1] "hello world!"</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="functional-interface">Functional Interface<a class="anchor" aria-label="anchor" href="#functional-interface"></a>
</h4>
<p>The primary object in the functional interface is the Socket. Use <code><a href="reference/socket.html">socket()</a></code> to create a socket, and optionally dial or listen at an address. The socket is then passed as the first argument of subsequent actions such as <code><a href="reference/send.html">send()</a></code> or <code><a href="reference/recv.html">recv()</a></code>.</p>
<p><em>Example using Pipeline (Push/Pull) protocol with TCP/IP transport:</em></p>
<p>Create sockets:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shikokuchuo.net/nanonext/">nanonext</a></span><span class="op">)</span>
<span class="va">socket1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span><span class="st">"push"</span>, listen <span class="op">=</span> <span class="st">"tcp://127.0.0.1:5555"</span><span class="op">)</span>
<span class="va">socket2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span><span class="st">"pull"</span>, dial <span class="op">=</span> <span class="st">"tcp://127.0.0.1:5555"</span><span class="op">)</span></code></pre></div>
<p>Send message from ‘socket1’:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/send.html">send</a></span><span class="op">(</span><span class="va">socket1</span>, <span class="st">"hello world!"</span><span class="op">)</span>
<span class="co">#&gt;  [1] 58 0a 00 00 00 03 00 04 01 02 00 03 05 00 00 00 00 05 55 54 46 2d 38 00 00</span>
<span class="co">#&gt; [26] 00 10 00 00 00 01 00 04 00 09 00 00 00 0c 68 65 6c 6c 6f 20 77 6f 72 6c 64</span>
<span class="co">#&gt; [51] 21</span></code></pre></div>
<p>Receive message using ‘socket2’:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/recv.html">recv</a></span><span class="op">(</span><span class="va">socket2</span><span class="op">)</span>
<span class="co">#&gt; $raw</span>
<span class="co">#&gt;  [1] 58 0a 00 00 00 03 00 04 01 02 00 03 05 00 00 00 00 05 55 54 46 2d 38 00 00</span>
<span class="co">#&gt; [26] 00 10 00 00 00 01 00 04 00 09 00 00 00 0c 68 65 6c 6c 6f 20 77 6f 72 6c 64</span>
<span class="co">#&gt; [51] 21</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $data</span>
<span class="co">#&gt; [1] "hello world!"</span></code></pre></div>
<p><a href="#table-of-contents">« Back to ToC</a></p>
</div>
</div>
<div class="section level3">
<h3 id="cross-language-exchange">Cross-language Exchange<a class="anchor" aria-label="anchor" href="#cross-language-exchange"></a>
</h3>
<p>{nanonext} provides a fast and reliable data interface between different programming languages where NNG has a binding, including C, C++, Java, Python, Go, Rust etc.</p>
<p>The following example demonstrates the exchange of numerical data between R and Python (NumPy), two of the most commonly-used languages for data science and machine learning.</p>
<p>Using a messaging interface provides a clean and robust approach, light on resources with limited and identifiable points of failure. This is especially relevant when processing real-time data, as an example.</p>
<p>This approach can also serve as an interface / pipe between different processes written in the same or different languages, running on the same computer or distributed across networks, and is an enabler of modular software design as espoused by the Unix philosophy.</p>
<p>Create socket in Python using the NNG binding ‘pynng’:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pynng</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>socket <span class="op">=</span> pynng.Pair0(listen<span class="op">=</span><span class="st">"ipc:///tmp/nanonext.socket"</span>)</span></code></pre></div>
<p>Create nano object in R using {nanonext}, then send a vector of ‘doubles’, specifying mode as ‘raw’:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shikokuchuo.net/nanonext/">nanonext</a></span><span class="op">)</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/nano.html">nano</a></span><span class="op">(</span><span class="st">"pair"</span>, dial <span class="op">=</span> <span class="st">"ipc:///tmp/nanonext.socket"</span><span class="op">)</span>
<span class="va">n</span><span class="op">$</span><span class="fu">send</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.1</span>, <span class="fl">2.2</span>, <span class="fl">3.3</span>, <span class="fl">4.4</span>, <span class="fl">5.5</span><span class="op">)</span>, mode <span class="op">=</span> <span class="st">"raw"</span><span class="op">)</span>
<span class="co">#&gt;  [1] 9a 99 99 99 99 99 f1 3f 9a 99 99 99 99 99 01 40 66 66 66 66 66 66 0a 40 9a</span>
<span class="co">#&gt; [26] 99 99 99 99 99 11 40 00 00 00 00 00 00 16 40</span></code></pre></div>
<p>Receive in Python as a NumPy array of ‘floats’, and send back to R:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>raw <span class="op">=</span> socket.recv()</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>array <span class="op">=</span> np.frombuffer(raw)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(array)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1.1 2.2 3.3 4.4 5.5]</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>msg <span class="op">=</span> array.tobytes()</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>socket.send(msg)</span></code></pre></div>
<p>Receive in R, specifying the receive mode as ‘double’:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span><span class="op">$</span><span class="fu">recv</span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"double"</span><span class="op">)</span>
<span class="co">#&gt; $raw</span>
<span class="co">#&gt;  [1] 9a 99 99 99 99 99 f1 3f 9a 99 99 99 99 99 01 40 66 66 66 66 66 66 0a 40 9a</span>
<span class="co">#&gt; [26] 99 99 99 99 99 11 40 00 00 00 00 00 00 16 40</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $data</span>
<span class="co">#&gt; [1] 1.1 2.2 3.3 4.4 5.5</span></code></pre></div>
<p><a href="#table-of-contents">« Back to ToC</a></p>
</div>
<div class="section level3">
<h3 id="async-and-concurrency">Async and Concurrency<a class="anchor" aria-label="anchor" href="#async-and-concurrency"></a>
</h3>
<p>{nanonext} implements true async send and receive, leveraging NNG as a massively-scalable concurrency framework.</p>
<p><code><a href="reference/send_aio.html">send_aio()</a></code> and <code><a href="reference/recv_aio.html">recv_aio()</a></code> functions return immediately but perform their operations async. Their results can be called using <code><a href="reference/call_aio.html">call_aio()</a></code> when required.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shikokuchuo.net/nanonext/">nanonext</a></span><span class="op">)</span>
<span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span><span class="st">"pair"</span>, listen <span class="op">=</span> <span class="st">"inproc://nano"</span><span class="op">)</span>
<span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span><span class="st">"pair"</span>, dial <span class="op">=</span> <span class="st">"inproc://nano"</span><span class="op">)</span></code></pre></div>
<p>For a ‘sendAio’ object, calling the result causes it to be stored in the AIO as <code>$result</code>. An exit code of 0 denotes a successful send.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/send_aio.html">send_aio</a></span><span class="op">(</span><span class="va">s1</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="reference/call_aio.html">call_aio</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>
<span class="va">res</span>
<span class="co">#&gt; &lt; sendAio &gt;</span>
<span class="co">#&gt;  - $result for send result</span>
<span class="va">res</span><span class="op">$</span><span class="va">result</span>
<span class="co">#&gt; [1] 0</span></code></pre></div>
<p>For a ‘recvAio’ object, calling the message causes it to be stored in the AIO as <code>$raw</code> (if kept) and <code>$data</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">msg</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/recv_aio.html">recv_aio</a></span><span class="op">(</span><span class="va">s2</span><span class="op">)</span>
<span class="fu"><a href="reference/call_aio.html">call_aio</a></span><span class="op">(</span><span class="va">msg</span><span class="op">)</span>
<span class="va">msg</span>
<span class="co">#&gt; &lt; recvAio &gt;</span>
<span class="co">#&gt;  - $raw for raw message</span>
<span class="co">#&gt;  - $data for message data</span>
<span class="va">msg</span><span class="op">$</span><span class="va">data</span>
<span class="co">#&gt;   a b</span>
<span class="co">#&gt; 1 1 2</span></code></pre></div>
<p>The values can also be accessed directly from the call as per the example below:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/call_aio.html">call_aio</a></span><span class="op">(</span><span class="va">msg</span><span class="op">)</span><span class="op">$</span><span class="va">data</span>
<span class="co">#&gt;   a b</span>
<span class="co">#&gt; 1 1 2</span>

<span class="fu"><a href="reference/close.html">close</a></span><span class="op">(</span><span class="va">s1</span><span class="op">)</span>
<span class="fu"><a href="reference/close.html">close</a></span><span class="op">(</span><span class="va">s2</span><span class="op">)</span></code></pre></div>
<p>As an example of possible applications, the {mirai} package <a href="https://shikokuchuo.net/mirai/" class="external-link uri">https://shikokuchuo.net/mirai/</a> (available on CRAN) uses {nanonext} as the back-end to provide asynchronous execution of arbitrary R code.</p>
<p><a href="#table-of-contents">« Back to ToC</a></p>
</div>
<div class="section level3">
<h3 id="rpc-and-distributed-computing">RPC and Distributed Computing<a class="anchor" aria-label="anchor" href="#rpc-and-distributed-computing"></a>
</h3>
<p>{nanonext} implements remote procedure calls (RPC) using NNG’s req/rep protocol to provide a basis for distributed computing.</p>
<p>Can be used to perform computationally-expensive calculations or I/O-bound operations such as writing large amounts of data to disk in a separate ‘server’ process running concurrently.</p>
<p>Server process: <code><a href="reference/reply.html">reply()</a></code> will wait for a message and apply a function, in this case <code><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm()</a></code>, before sending back the result</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shikokuchuo.net/nanonext/">nanonext</a></span><span class="op">)</span>
<span class="va">rep</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span><span class="st">"rep"</span>, listen <span class="op">=</span> <span class="st">"tcp://127.0.0.1:6546"</span><span class="op">)</span>
<span class="va">ctxp</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/context.html">context</a></span><span class="op">(</span><span class="va">rep</span><span class="op">)</span>
<span class="fu"><a href="reference/reply.html">reply</a></span><span class="op">(</span><span class="va">ctxp</span>, execute <span class="op">=</span> <span class="va">rnorm</span>, send_mode <span class="op">=</span> <span class="st">"raw"</span><span class="op">)</span> </code></pre></div>
<p>Client process: <code><a href="reference/request.html">request()</a></code> performs an async send and receive request and returns immediately with a <code>recvAio</code> object.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shikokuchuo.net/nanonext/">nanonext</a></span><span class="op">)</span>
<span class="va">req</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span><span class="st">"req"</span>, dial <span class="op">=</span> <span class="st">"tcp://127.0.0.1:6546"</span><span class="op">)</span>
<span class="va">ctxq</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/context.html">context</a></span><span class="op">(</span><span class="va">req</span><span class="op">)</span>
<span class="va">aio</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/request.html">request</a></span><span class="op">(</span><span class="va">ctxq</span>, data <span class="op">=</span> <span class="fl">1e8</span>, recv_mode <span class="op">=</span> <span class="st">"double"</span>, keep.raw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>At this point, the client can run additional code concurrent with the server processing the request.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># do more...</span></code></pre></div>
<p>When the result of the server calculation is required, the <code>recvAio</code> may be called using <code><a href="reference/call_aio.html">call_aio()</a></code>.</p>
<p>The return value from the server request is then retrieved and stored in the Aio as <code>$data</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/call_aio.html">call_aio</a></span><span class="op">(</span><span class="va">aio</span><span class="op">)</span>

<span class="va">aio</span>
<span class="co">#&gt; &lt; recvAio &gt;</span>
<span class="co">#&gt;  - $raw for raw message</span>
<span class="co">#&gt;  - $data for message data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">aio</span><span class="op">$</span><span class="va">data</span><span class="op">)</span>
<span class="co">#&gt;  num [1:100000000] -0.771 -0.379 -0.377 -1.401 -1.579 ...</span></code></pre></div>
<p>In this example the calculation is returned, but other operations may reside entirely on the server side, for example writing data to disk.</p>
<p>In such a case, using <code><a href="reference/call_aio.html">call_aio()</a></code> confirms that the operation has completed (or it will wait for completion) and calls the return value of the function, which may typically be NULL or an exit code.</p>
<p><a href="#table-of-contents">« Back to ToC</a></p>
</div>
<div class="section level3">
<h3 id="publisher-subscriber-model">Publisher Subscriber Model<a class="anchor" aria-label="anchor" href="#publisher-subscriber-model"></a>
</h3>
<p>{nanonext} fully implements NNG’s pub/sub protocol as per the below example.</p>
<p>This example uses the new R4.1 pipe for clarity of code, although this is of course not required.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pub</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span><span class="st">"pub"</span>, listen <span class="op">=</span> <span class="st">"inproc://nanobroadcast"</span><span class="op">)</span>
<span class="va">sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/socket.html">socket</a></span><span class="op">(</span><span class="st">"sub"</span>, dial <span class="op">=</span> <span class="st">"inproc://nanobroadcast"</span><span class="op">)</span>

<span class="va">sub</span> |&gt; <span class="fu"><a href="reference/subscribe.html">subscribe</a></span><span class="op">(</span>topic <span class="op">=</span> <span class="st">"examples"</span><span class="op">)</span>
<span class="va">pub</span> |&gt; <span class="fu"><a href="reference/send.html">send</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"examples"</span>, <span class="st">"this is an example"</span><span class="op">)</span>, mode <span class="op">=</span> <span class="st">"raw"</span>, echo <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">sub</span> |&gt; <span class="fu"><a href="reference/recv.html">recv</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"character"</span>, keep.raw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; [1] "examples"           "this is an example"</span>

<span class="va">pub</span> |&gt; <span class="fu"><a href="reference/send.html">send</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"other"</span>, <span class="st">"this other topic will not be received"</span><span class="op">)</span>, mode <span class="op">=</span> <span class="st">"raw"</span>, echo <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">sub</span> |&gt; <span class="fu"><a href="reference/recv.html">recv</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"character"</span>, keep.raw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; 2022-03-02 17:01:22 [ 8 ] Try again</span>

<span class="co"># specify NULL to subscribe to ALL topics</span>
<span class="va">sub</span> |&gt; <span class="fu"><a href="reference/subscribe.html">subscribe</a></span><span class="op">(</span>topic <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
<span class="va">pub</span> |&gt; <span class="fu"><a href="reference/send.html">send</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"newTopic"</span>, <span class="st">"this is a new topic"</span><span class="op">)</span>, mode <span class="op">=</span> <span class="st">"raw"</span>, echo <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">sub</span> |&gt; <span class="fu"><a href="reference/recv.html">recv</a></span><span class="op">(</span><span class="st">"character"</span>, keep.raw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; [1] "newTopic"            "this is a new topic"</span>

<span class="va">sub</span> |&gt; <span class="fu"><a href="reference/unsubscribe.html">unsubscribe</a></span><span class="op">(</span>topic <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
<span class="va">pub</span> |&gt; <span class="fu"><a href="reference/send.html">send</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"newTopic"</span>, <span class="st">"this topic will now not be received"</span><span class="op">)</span>, mode <span class="op">=</span> <span class="st">"raw"</span>, echo <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">sub</span> |&gt; <span class="fu"><a href="reference/recv.html">recv</a></span><span class="op">(</span><span class="st">"character"</span>, keep.raw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; 2022-03-02 17:01:22 [ 8 ] Try again</span>

<span class="co"># however the topics explicitly subscribed to are still received</span>
<span class="va">pub</span> |&gt; <span class="fu"><a href="reference/send.html">send</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"examples"</span>, <span class="st">"this example will still be received"</span><span class="op">)</span>, mode <span class="op">=</span> <span class="st">"raw"</span>, echo <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">sub</span> |&gt; <span class="fu"><a href="reference/recv.html">recv</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"character"</span>, keep.raw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; [1] "examples"                            "this example will still be received"</span>

<span class="fu"><a href="reference/close.html">close</a></span><span class="op">(</span><span class="va">pub</span><span class="op">)</span>
<span class="fu"><a href="reference/close.html">close</a></span><span class="op">(</span><span class="va">sub</span><span class="op">)</span></code></pre></div>
<p><a href="#table-of-contents">« Back to ToC</a></p>
</div>
<div class="section level3">
<h3 id="ncurl-minimalist-http-client">ncurl Minimalist http Client<a class="anchor" aria-label="anchor" href="#ncurl-minimalist-http-client"></a>
</h3>
<p><code><a href="reference/ncurl.html">ncurl()</a></code> is a minimalistic http(s) client. In normal use, it takes only one argument, the URL. It can follow redirects.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/ncurl.html">ncurl</a></span><span class="op">(</span><span class="st">"http://httpbin.org/headers"</span><span class="op">)</span>
<span class="co">#&gt; $raw</span>
<span class="co">#&gt;   [1] 7b 0a 20 20 22 68 65 61 64 65 72 73 22 3a 20 7b 0a 20 20 20 20 22 48 6f 73</span>
<span class="co">#&gt;  [26] 74 22 3a 20 22 68 74 74 70 62 69 6e 2e 6f 72 67 22 2c 20 0a 20 20 20 20 22</span>
<span class="co">#&gt;  [51] 58 2d 41 6d 7a 6e 2d 54 72 61 63 65 2d 49 64 22 3a 20 22 52 6f 6f 74 3d 31</span>
<span class="co">#&gt;  [76] 2d 36 32 31 66 61 32 65 33 2d 37 66 31 34 35 62 63 64 31 65 34 34 36 34 61</span>
<span class="co">#&gt; [101] 66 36 62 61 62 63 63 33 64 22 0a 20 20 7d 0a 7d 0a</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $data</span>
<span class="co">#&gt; [1] "{\n  \"headers\": {\n    \"Host\": \"httpbin.org\", \n    \"X-Amzn-Trace-Id\": \"Root=1-621fa2e3-7f145bcd1e4464af6babcc3d\"\n  }\n}\n"</span></code></pre></div>
<p>For advanced use, supports additional HTTP methods such as POST or PUT.</p>
<p><a href="#table-of-contents">« Back to ToC</a></p>
</div>
<div class="section level3">
<h3 id="building-from-source">Building from source<a class="anchor" aria-label="anchor" href="#building-from-source"></a>
</h3>
<div class="section level4">
<h4 id="linux--mac--solaris">Linux / Mac / Solaris<a class="anchor" aria-label="anchor" href="#linux--mac--solaris"></a>
</h4>
<p>Installation from source requires the C library ‘libnng’ along with its development headers.</p>
<p>This is available in system package repositories as:</p>
<ul>
<li>
<code>libnng-dev</code> (deb)</li>
<li>
<code>nng-devel</code> (rpm)</li>
<li>
<code>nng</code> (Homebrew on MacOS)</li>
<li>
<code>nng</code> from vcpkg (see <a href="https://vcpkg.io/" class="external-link uri">https://vcpkg.io/</a>).</li>
</ul>
<p>A system installation of ‘libnng’ in the standard filesystem locations will be detected and used if possible.</p>
<p>Otherwise, a release version of ‘libnng’ will be downloaded and built from source automatically during package installation (note: this requires ‘cmake’).</p>
</div>
<div class="section level4">
<h4 id="windows">Windows<a class="anchor" aria-label="anchor" href="#windows"></a>
</h4>
<p>Pre-built libraries (for i386 / x64 / x64-UCRT) are automatically downloaded during the package installation process.</p>
</div>
<div class="section level4">
<h4 id="tls-support">TLS Support<a class="anchor" aria-label="anchor" href="#tls-support"></a>
</h4>
<p>If your system installation of NNG was built with TLS support (using Mbed TLS), please set the environment variable <code>Sys.setenv(NANONEXT_TLS=1)</code> before attempting to install the package. This will ensure the correct linker flags are set for a successful install.</p>
</div>
<div class="section level4">
<h4 id="certain-arm-architectures">Certain ARM architectures<a class="anchor" aria-label="anchor" href="#certain-arm-architectures"></a>
</h4>
<p>If package installation initially fails with an error message of <code>unable to load shared object:[ ] undefined symbol: __atomic_fetch_sub_8</code> or similar, please set the environment variable <code>Sys.setenv(NANONEXT_ARM=1)</code> and then proceed with installation again.</p>
</div>
</div>
<div class="section level3">
<h3 id="links">Links<a class="anchor" aria-label="anchor" href="#links"></a>
</h3>
<p>nanonext on CRAN: <a href="https://cran.r-project.org/package=nanonext" class="external-link uri">https://cran.r-project.org/package=nanonext</a><br> Package website: <a href="https://shikokuchuo.net/nanonext/" class="uri">https://shikokuchuo.net/nanonext/</a><br></p>
<p>NNG website: <a href="https://nng.nanomsg.org/" class="external-link uri">https://nng.nanomsg.org/</a><br> NNG documentation: <a href="https://nng.nanomsg.org/man/tip/" class="external-link uri">https://nng.nanomsg.org/man/tip/</a><br></p>
<p><a href="#table-of-contents">« Back to ToC</a></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=nanonext" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/shikokuchuo/nanonext/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/shikokuchuo/nanonext/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing nanonext</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Charlie Gao <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-0750-061X" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://CRAN.R-project.org/package=nanonext" class="external-link"><img src="https://www.r-pkg.org/badges/version/nanonext?color=112d4e" alt="CRAN status"></a></li>
<li><a href="https://shikokuchuo.r-universe.dev" class="external-link"><img src="https://shikokuchuo.r-universe.dev/badges/nanonext?color=3f72af" alt="nanonext status badge"></a></li>
<li><a href="https://github.com/shikokuchuo/nanonext/actions" class="external-link"><img src="https://github.com/shikokuchuo/nanonext/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Charlie Gao.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
